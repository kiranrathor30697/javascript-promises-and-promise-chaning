<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Student Api</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    </head>
    <body>
        <!-- http://localhost:1337/api/students -->
             

            <button class="btn btn-success d-grid gap-2 mx-auto mt-5" onclick="btnClick()">Get My Students Data</button>

            <div class="d-flex justify-content-center invisible k_loader">
                <div class="spinner-border text-success" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
            </div>


            <!--View Button Modal -->
            
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">View Student Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <ul class="list-group">
                            <li class="list-group-item k_item1"></li>
                            <li class="list-group-item k_item2"></li>
                            <li class="list-group-item k_item3"></li>
                            <li class="list-group-item k_item4"></li>
                            <li class="list-group-item k_item5"></li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
                </div>
            </div>

        <script>

            let btnClick = ()=>{
                
               let loader = document.getElementsByClassName('k_loader');
               
                // if(f == ""){
                //     console.log('okokok')
                // }else{
                //     console.log("not Okokoko")
                // }

                //alert("clicked")
                fetch('http://localhost:1337/api/students')
                .then(res=>res.json())
                .then((data)=>{
                    //console.log(data.data);
                    tr = ` <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">ID</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Surname</th>
                                        <th scope="col">Age</th>
                                        <th scope="col">Subject</th>
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                    data.data.map((cv,idx,arr)=>{
                        //console.log(cv.id)
                        tr  +=  `<tr>
                                    <td>`+cv.id+`</td>
                                    <td>`+cv.attributes.name+`</td>
                                    <td>`+cv.attributes.surname+`</td>
                                    <td>`+cv.attributes.age+`</td>
                                    <td>`+cv.attributes.subject+`</td>
                                    <td>
                                        <button class="btn btn-success btn-sm k_view" data-bs-toggle="modal" data-bs-target="#exampleModal" >View</button>
                                        <button class="btn btn-info btn-sm k_edit">Edit</button>
                                        <button class="btn btn-danger btn-sm k_del">Delete</button>    
                                    </td>
                                 </tr>`
                    })
                    //console.log(tr)
                        tr += ` </tbody>
                            </table>`
                    document.body.innerHTML += tr;

                })
                .catch((error)=>{
                    console.log(error);
                });
            }
            document.body.addEventListener('click',(e)=>{
                //alert('itsokk')
                let action_btn = e.target.classList[3];
                if(action_btn == "k_view"){
                    //alert("View");
                    let v_data = e.target.closest('tr');
                    //console.log(view_data);

                    let id = v_data.querySelector('td:first-child').innerHTML;
                    let name = v_data.querySelector('td:nth-child(2)').innerHTML;
                    let surname = v_data.querySelector('td:nth-child(3)').innerHTML;
                    let age = v_data.querySelector('td:nth-child(4)').innerHTML;
                    let subject = v_data.querySelector('td:nth-child(5)').innerHTML;

                    //  console.log(id);
                    //  console.log(name);
                    // console.log(surname);
                    // console.log(age);
                    // console.log(subject);

                    document.querySelector(".k_item1").innerHTML = id;
                    document.querySelector(".k_item2").innerHTML = name;
                    document.querySelector(".k_item3").innerHTML = surname;
                    document.querySelector(".k_item4").innerHTML = age;
                    document.querySelector(".k_item5").innerHTML = subject;
                        

                }else if(action_btn == "k_edit"){
                    //alert("Edit");

                }else if(action_btn == "k_del"){
                    alert("Delete");

                    swal({
                        title: "Are you sure? Delete This Data And Reload This Page",
                        text: "Once deleted, you will not be able to recover this Data!",
                        icon: "warning",
                        buttons: true,
                        dangerMode: true,
                        })
                        .then((willDelete) => {
                        if (willDelete) {
                            //e.target.closest('tr').remove('tr');


                            let delid = e.target.closest('tr').querySelector('td:first-child').innerHTML
                            console.log(delid)
                            fetch('http://localhost:1337/api/students/'+delid,{
                                method:"DELETE"
                            })
                            .then(res=>res.json())
                            .then((data)=>{
                                console.log(data);
                                swal("Poof! Your Data has been deleted Successfully!", {
                                    icon: "success",
                                });
                                //location.reload();
                                e.target.closest('tr').remove('tr');
                            })
                            .catch((err)=>{
                                console.log(err)
                            });

                    //         fetch('http://localhost:1337/api/students/'+delid,{
                    //     method:"DELETE"
                    // }).then(response => response.json()).then(data=>{
                    //    // console.log('deleted successfully');
                    //    swal("Good job!", "You clicked the button!", "success");
                    // }).catch().finally();
  
                        } else {
                            swal("Your Data is safe!");
                        }
                    });   
                }
            });
        </script>
    </body>
</html>